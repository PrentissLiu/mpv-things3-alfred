
# MPV-Things3-Alfred 断点续播

> 一个通过 Alfred 联动 mpv 和 Things 3 的自动化流程，可以方便地记录和恢复视频的播放进度、速度及窗口状态。

## 功能简介

本套工作流包含两个核心的 Alfred Workflow，实现了以下功能：

* **一键保存 (`mpvsave`)**：当您使用 `mpv` 观看视频时，可以随时触发此工作流。它会：
    1.  精确获取当前视频的**文件路径、播放时间、播放速度、窗口大小和位置**。
    2.  将这些信息整合成一条“恢复指令”，并自动**复制到您的剪贴板**。
    3.  唤起 **Things 3 的快捷输入窗口**，并自动填好待办事项：
        * **标题**：`继续播放：<文件名> (已播放至 X分 或 X小时X分)`
        * **备注**：包含完整的“恢复指令”，方便随时复制。
* **一键恢复 (`mpvrecover`)**：当您想继续观看视频时，此工作流会：
    1.  读取您剪贴板中的“恢复指令”。
    2.  在后台**静默启动 `mpv`**，并完美重现上次的播放时间、速度、窗口大小和位置。

## 依赖组件 (Prerequisites)

在安装和使用本套工作流前，请确保您的 macOS 系统上已安装以下所有软件和工具：

1.  **mpv**: 强大的命令行视频播放器。
2.  **Things 3**: 优雅的GTD任务管理工具。
3.  **Alfred**: 并已购买 Powerpack 以支持工作流功能。
4.  **Homebrew**: macOS 的包管理器，用于安装命令行工具。
5.  **socat**: 用于进程间通信的命令行工具。
6.  **jq**: 用于解析JSON的命令行工具。

## 安装与配置 (Installation & Configuration)

请严格按照以下步骤进行安装和配置，以确保工作流能正常运行。

#### 步骤一：安装命令行依赖

打开“终端”应用，使用 Homebrew 安装 `mpv`, `socat` 和 `jq`。
```bash
brew install mpv socat jq
```
*(如果您尚未安装 Homebrew, 请先从其官网 `brew.sh` 获取安装命令进行安装。)*

#### 步骤二：配置 MPV

为了让 Alfred 能与 mpv 通信，我们需要让 mpv 在每次启动时都自动开启 IPC 服务。

1.  在终端中，执行以下命令来创建 `mpv` 的配置文件（如果文件或目录已存在，这些命令不会造成任何影响）：
    ```bash
    mkdir -p ~/.config/mpv
    touch ~/.config/mpv/mpv.conf
    ```
2.  用任何文本编辑器打开 `~/.config/mpv/mpv.conf` 文件，在其中加入下面这一行内容并保存：
    ```
    input-ipc-server=/tmp/mpvsocket
    ```
    这会使 `mpv` 在每次启动时都自动创建用于通信的 socket 文件。

#### 步骤三：安装 Alfred 工作流

您应该有两个 `.alfredworkflow` 文件：一个用于保存 (`mpvsave`)，一个用于恢复 (`mpvrecover`)。请分别**双击**这两个文件，Alfred 会引导您完成安装。

## 使用流程 (Usage)

1.  **启动播放**：在 Finder 中**双击**任何视频文件，系统会默认使用 `mpv` 打开并播放。由于步骤二的配置，此时它已经准备好被 Alfred 控制了。

2.  **保存进度**：在视频播放或暂停时，随时可以呼出 Alfred 主窗口，输入关键词 `mpvsave`，然后按回车。
    * 您的剪贴板会被写入恢复指令。
    * Things 3 的快捷输入窗口会弹出，其中已填好所有信息。您只需检查并保存即可。

3.  **恢复播放**：
    * 打开 Things 3，找到对应的待办事项，从备注中**复制**那条 `mpvrecover file:...` 的恢复指令。
    * 呼出 Alfred 主窗口，粘贴恢复的指令，然后按回车。
    * `mpv` 会在后台启动，并恢复到您上次保存时的所有状态。

## 注意事项

* 恢复 (`mpvrecover`) 工作流的功能完全依赖于**剪贴板**。在执行恢复前，请确保剪贴板的内容是正确的恢复指令。
* 脚本中的工具路径（如 `/usr/local/bin/mpv`）是基于标准的 Homebrew 安装位置。如果您的安装位置不同，请相应修改工作流脚本中的路径变量。

